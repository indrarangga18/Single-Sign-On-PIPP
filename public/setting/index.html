<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SSO PIPP — Settings Microservices</title>
  <link rel="icon" href="/images/logo-kkp-pipp.png" />
  <style>
    :root {
      --bg: linear-gradient(135deg,#0b1020,#0e1e3c 50%,#061a3a);
      --glass: rgba(18,28,56,.60);
      --border: rgba(120,200,255,.28);
      --muted: #a7b4c7; --text: #e6f2ff;
      --primary: #0ea5e9; --secondary: #6366f1; --ok:#22c55e; --bad:#ef4444;
    }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .fx{position:fixed;inset:0;pointer-events:none;z-index:0}
    .orb{position:absolute;width:380px;height:380px;border-radius:50%;filter:blur(86px);opacity:.35}
    .orb.o1{background:radial-gradient(closest-side,rgba(53,225,255,.9),transparent 72%);top:10%;left:8%;animation:float 14s ease-in-out infinite}
    .orb.o2{background:radial-gradient(closest-side,rgba(167,139,250,.9),transparent 72%);bottom:12%;right:10%;animation:float 18s ease-in-out infinite reverse}
    .orb.o3{background:radial-gradient(closest-side,rgba(96,165,250,.9),transparent 72%);top:58%;left:58%;animation:float 22s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(16px,-12px)}}
    .layout{display:flex;gap:20px;padding:20px;min-height:100vh;position:relative;z-index:1}
    .sidebar{width:220px;min-width:220px;background:var(--glass);border:1px solid var(--border);border-radius:12px;backdrop-filter:blur(10px);padding:12px;position:sticky;top:20px;height:calc(100vh - 40px);box-shadow:0 12px 28px rgba(34,211,238,.12)}
    .brand{display:flex;align-items:center;gap:10px;padding:8px 6px;border-bottom:1px solid var(--border);margin-bottom:10px}
    .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--primary),var(--secondary))}
    .menu{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .menu a{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:#dbeafe;text-decoration:none;border:1px solid var(--border);background:rgba(10,20,50,.35)}
    .menu a.active{border-color:rgba(140,220,255,.45);box-shadow:0 0 12px rgba(34,211,238,.12)}
    .main{flex:1;min-width:0}
    .topbar{background:var(--glass);border:1px solid var(--border);border-radius:12px;backdrop-filter:blur(10px);padding:10px 12px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}
    .brand-title{font-weight:800;letter-spacing:.3px;background:linear-gradient(90deg,var(--primary),var(--secondary));-webkit-background-clip:text;background-clip:text;color:transparent}
    .header{background:rgba(18,28,56,.55);border:1px solid var(--border);border-radius:15px;padding:24px;margin-bottom:20px}
    .header h1{margin:0 0 8px;font-size:24px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
    .tab{border:1px solid var(--border);background:rgba(12,20,40,.55);color:#e6f2ff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .tab.active{background:linear-gradient(90deg,var(--primary),var(--secondary));border-color:transparent}
    .panel{display:none;background:rgba(18,28,56,.55);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:18px}
    .panel.active{display:block}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .card{background:rgba(12,20,40,.55);border:1px solid var(--border);border-radius:12px;padding:14px}
    .card h3{margin:0 0 8px;font-size:16px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .input,select,textarea{width:100%;border:1px solid rgba(226,232,240,.25);border-radius:10px;background:rgba(255,255,255,.06);color:#e2e8f0;padding:8px}
    .btn{border:none;border-radius:10px;padding:8px 12px;color:#fff;background:linear-gradient(90deg,var(--primary),var(--secondary));cursor:pointer}
    .btn.secondary{background:linear-gradient(90deg,#14b8a6,#22c55e)}
    .btn.danger{background:linear-gradient(90deg,#ef4444,#f43f5e)}
    /* Action header & attractive buttons */
    .card-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .card-head .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn.icon{display:inline-flex;align-items:center;gap:8px}
    .btn.glow{box-shadow:0 8px 18px rgba(14,165,233,.25)}
    .btn.glow:hover{filter:brightness(1.06);box-shadow:0 10px 24px rgba(14,165,233,.35)}
    .btn.outline{background:rgba(10,20,50,.35);border:1px solid var(--border);color:#dbeafe}
    .btn.outline:hover{background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;border-color:transparent}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid rgba(120,200,255,.18);padding:8px;text-align:left}
    .stat{display:flex;gap:12px;align-items:center}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:#dbeafe}
    .uptime-ring{border-radius:50%;background:rgba(12,20,40,.35)}
    .muted{color:var(--muted);font-size:12px}
    .toggle-btn{margin-left:auto;border:1px solid var(--border);background:rgba(10,20,50,.35);color:#dbeafe;border-radius:8px;padding:6px 8px;cursor:pointer}
    .sidebar.collapsed{width:72px;min-width:72px}
    .sidebar.collapsed .brand .muted,.sidebar.collapsed .brand .brand-title{display:none}
    .sidebar.collapsed .menu .label{display:none}
    /* Futuristic API Config UI */
    .chip{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px}
    .chip.get{background:linear-gradient(90deg,#0ea5e9,#22d3ee);color:#fff}
    .chip.post{background:linear-gradient(90deg,#22c55e,#14b8a6);color:#fff}
    .chip.put{background:linear-gradient(90deg,#f59e0b,#f97316);color:#fff}
    .chip.delete{background:linear-gradient(90deg,#ef4444,#f43f5e);color:#fff}
    .chip.patch{background:linear-gradient(90deg,#8b5cf6,#6366f1);color:#fff}
    .chip.head{background:linear-gradient(90deg,#64748b,#94a3b8);color:#fff}
    .chip.auth{background:linear-gradient(90deg,#0ea5e9,#6366f1);color:#fff}
    .status-pill{display:inline-block;padding:4px 8px;border-radius:10px;font-size:12px;border:1px solid var(--border)}
    .status-pill.active{background:rgba(34,197,94,.15);color:#22c55e}
    .status-pill.inactive{background:rgba(244,63,94,.15);color:#f43f5e}
    .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:10px}
    .toolbar .input{max-width:280px}
    /* Toast */
    .toast-container{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);z-index:100;display:flex;flex-direction:column;gap:8px;align-items:center;pointer-events:none}
    .toast{background:rgba(12,20,40,.85);color:#dbeafe;border:1px solid var(--border);border-radius:10px;padding:10px 12px;min-width:220px;box-shadow:0 10px 24px rgba(0,0,0,.35);opacity:0;transform:translateY(8px);transition:opacity .2s ease, transform .2s ease}
    .toast.show{opacity:1;transform:translateY(0)}
    .toast.success{border-color:#22c55e}
    .toast.error{border-color:#ef4444}
    .toast.info{border-color:#14b8a6}
    /* Fix KPI grid to stay inside the card and be responsive */
    .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;width:100%}
    .kpi .item{background:rgba(12,20,40,.55);border:1px solid var(--border);border-radius:12px;padding:12px;min-height:84px;display:flex;flex-direction:column;justify-content:center}
    .kpi .num{font-size:22px;font-weight:700}
    .kpi .num .num-ok{color:var(--ok)}
    .kpi .num .num-bad{color:var(--bad)}
    .kpi .label{font-size:12px;color:var(--muted)}
    tbody tr:hover{background:rgba(12,20,40,.35)}
    /* Overview charts */
    .overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; justify-items: center; }
      /* Gaya khusus untuk men-center dua chart utama */
      #mini-methods, #mini-access { text-align: center; }
      #mini-methods canvas, #mini-access canvas { display: block; margin: 0 auto; }
      /* Ukuran Access Ratio yang lebih besar */
      #mini-access { padding: 10px; }
      #mini-access canvas { width: 160px; height: 160px; }
      #mini-access .mini-title { font-size: 13px; }
      #mini-access .mini-legend { font-size: 12px; gap: 8px; }
      .mini { background: rgba(12, 20, 40, 0.55); border: 1px solid var(--border); border-radius: 12px; padding: 10px; position: relative; }
      .mini-title { font-size: 12px; color: var(--muted); margin-bottom: 6px; letter-spacing: 0.4px; }
    .mini canvas { width: 100%; height: auto; }
    .mini .glow-line { position: absolute; height: 1px; left: 10px; right: 10px; top: 36px; background: linear-gradient(90deg, var(--primary), var(--secondary)); opacity: 0.25; }
    .mini-legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .legend-item{display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#a7b4c7;border:1px solid var(--border);border-radius:12px;padding:4px 8px;background:rgba(12,20,40,.35)}
    .legend-dot{width:10px;height:10px;border-radius:50%}
    .badge-small{position:absolute;top:8px;right:10px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:11px;color:#dbeafe;background:rgba(12,20,40,.55);backdrop-filter:blur(6px);box-shadow:0 6px 16px rgba(0,0,0,.25);transition:transform .18s ease, opacity .18s ease;opacity:.9}
    .badge-small.show{opacity:1;transform:translateY(0)}
    .badge-small.dominant-public{border-color:#22c55e;background:rgba(34,197,94,.12);color:#bbf7d0}
    .badge-small.dominant-private{border-color:#f43f5e;background:rgba(244,63,94,.12);color:#fecdd3}
    .badge-small.balanced{border-color:#94a3b8;background:rgba(148,163,184,.12);color:#e5e7eb}
    /* Info Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);display:none;z-index:50}
    .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(12,20,40,.92);border:1px solid var(--border);border-radius:12px;box-shadow:0 18px 36px rgba(0,0,0,.35);width:min(720px,90vw);max-height:80vh;display:none;z-index:51}
    .modal.open,.modal-backdrop.open{display:block}
    .modal-header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .modal-title{font-size:14px;font-weight:700;color:#dbeafe}
    .modal-body{padding:12px 14px;overflow:auto}
    .close-btn{border:1px solid var(--border);background:rgba(10,20,50,.35);color:#dbeafe;border-radius:8px;padding:6px 8px;cursor:pointer}
    .code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; background:rgba(255,255,255,.06); border:1px solid rgba(226,232,240,.18); border-radius:8px; padding:8px; color:#e2e8f0}

    /* Register API Futuristic */
    .field{display:flex;flex-direction:column;gap:6px;position:relative}
    .label{font-size:12px;color:var(--muted)}
    .req{color:#f43f5e;font-weight:700;}
    .input.invalid{border-color:#f43f5e;box-shadow:0 0 0 2px rgba(244,63,94,.25)}
    .seg{display:flex;gap:8px;flex-wrap:wrap}
    .seg button{border:1px solid var(--border);background:rgba(12,20,40,.55);color:#e6f2ff;border-radius:999px;padding:6px 10px;cursor:pointer}
    .seg button.active{background:linear-gradient(90deg,var(--primary),var(--secondary));border-color:transparent}
    .hint{font-size:12px;color:var(--muted)}
    .error-msg{font-size:12px;color:#f43f5e}
    .info-tip{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;border:1px solid var(--border);background:rgba(12,20,40,.55);color:#fbbf24;font-size:12px;line-height:1;margin-left:6px;cursor:help}
    .info-tip:hover{background:rgba(12,20,40,.75);}
    .popover{position:absolute;top:28px;left:0;display:none;background:rgba(12,20,40,.85);border:1px solid var(--border);border-radius:12px;padding:10px;max-width:320px;box-shadow:0 10px 24px rgba(0,0,0,.35);z-index:10;opacity:0;transform:translateX(6px);transition:opacity .18s ease, transform .18s ease}
    .popover.open{display:block;opacity:1;transform:translateX(0)}
    .popover-title{font-size:13px;font-weight:600;margin-bottom:6px;color:#dbeafe}
    .popover::before{content:"";position:absolute;left:-6px;top:14px;border-width:6px;border-style:solid;border-color:transparent var(--border) transparent transparent}
    .popover::after{content:"";position:absolute;left:-5px;top:14px;border-width:6px;border-style:solid;border-color:transparent rgba(12,20,40,.85) transparent transparent}
     .field .label:hover + .popover{display:block}
      /* Stack API Config cards vertically */
    #panel-api .grid{grid-template-columns:1fr;gap:16px}
    /* Form two-column grid */
     #panel-api .form-grid{display:flex;gap:12px;align-items:flex-start}
     #panel-api .form-grid .col{flex:0 1 520px;display:flex;flex-direction:column;gap:8px}
     #panel-api .form-grid .col:last-child{flex:0 1 520px}
      /* Perkecil lebar input akses & authentication */
      #panel-api #api-access,#panel-api #api-auth{max-width:240px}
      #panel-api .access-method{flex-wrap:nowrap;gap:12px;align-items:flex-start;flex-wrap:nowrap;}
      #panel-api .form-pairs .pair { flex:1 1 0; min-width:0; display:flex; flex-direction:column; gap:8px; }
      #panel-api .access-method { display:flex; flex-wrap:nowrap; gap:12px; }
      #panel-api .method-inline { flex:1 1 auto; min-width:0; }
      @media (max-width: 640px) {
        #panel-api .form-pairs { flex-direction:column; flex-wrap:wrap; }
        /* Pair rows container */
        #panel-api .form-pairs { display:flex; gap:12px; align-items:flex-start; flex-wrap:nowrap; }
        /* Rapatkan jarak antar baris pasangan */
        #panel-api .card .row.form-pairs + .row.form-pairs { gap:6px; margin-top:0; }
        /* Pair items */
        #panel-api .form-pairs .pair { flex:1 1 0; min-width:0; display:flex; flex-direction:column; gap:8px; }
        /* Akses + Method row */
        #panel-api .access-method { display:flex; flex-wrap:nowrap; gap:12px; align-items:flex-start; }
        #panel-api .method-inline { flex:1 1 auto; min-width:0; }
        /* Keep akses/auth compact */
        #panel-api #api-access, #panel-api #api-auth { max-width:240px; }
        /* Mobile */
        @media (max-width: 640px) {
          #panel-api .form-pairs { flex-direction:column; flex-wrap:wrap; gap:10px; }
          #panel-api .card .row.form-pairs + .row.form-pairs { margin-top:0; }
          #panel-api #api-access, #panel-api #api-auth { max-width:100%; }
        }
      }
      /* keep akses/auth inputs compact on desktop */
      #panel-api #api-access, #panel-api #api-auth { max-width: 240px; }
      /* Rapatkan lagi: baris kedua tanpa margin ekstra */
      #panel-api .card .row.form-pairs + .row.form-pairs { gap:6px; margin-top:0; }
      /* Perkecil tinggi area Method */
      #panel-api .method-inline .label { margin-bottom:4px; }
      #panel-api .method-inline .seg { display:flex; flex-wrap:wrap; gap:4px; margin-bottom:0; }
      #panel-api #method-hint { display:none; }
    /* Tabel API layout fix */
    #panel-api table{width:100%;table-layout:fixed;border-collapse:collapse}
    #panel-api table th,#panel-api table td{padding:8px 10px;vertical-align:middle}
    #panel-api table th{white-space:nowrap}
    #panel-api table td:nth-child(6){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    /* Lebar kolom agar rapi */
    #panel-api table th:nth-child(1),#panel-api table td:nth-child(1){width:18%}
    #panel-api table th:nth-child(2),#panel-api table td:nth-child(2){width:12%}
    #panel-api table th:nth-child(3),#panel-api table td:nth-child(3){width:14%}
    #panel-api table th:nth-child(4),#panel-api table td:nth-child(4){width:10%}
    #panel-api table th:nth-child(5),#panel-api table td:nth-child(5){width:10%}
    #panel-api table th:nth-child(6),#panel-api table td:nth-child(6){width:18%}
    #panel-api table th:nth-child(7),#panel-api table td:nth-child(7){width:6%}
    #panel-api table th:nth-child(8),#panel-api table td:nth-child(8){width:8%}
    #panel-api table th:nth-child(9),#panel-api table td:nth-child(9){width:14%}
    #panel-api .chip{display:inline-block;margin-right:6px}
    @media (min-width: 960px){
      #panel-api .grid{grid-template-columns:1fr 1fr;gap:16px}
      #panel-api .grid .card:first-child{grid-column:1/-1}
      #panel-api .grid .card:nth-child(2){grid-column:1/-1}
      #panel-api .grid .card:nth-child(3){grid-column:1/-1}
    }
  </style>
</head>
<body>
  <div class="fx" aria-hidden="true"><span class="orb o1"></span><span class="orb o2"></span><span class="orb o3"></span></div>
  <div class="layout">
    <aside class="sidebar" style="display:none"></aside>
    <main class="main">
      <div id="info-backdrop" class="modal-backdrop" aria-hidden="true"></div>
      <div id="info-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="info-title" aria-describedby="info-body">
        <div class="modal-header">
          <div class="modal-title" id="info-title">API Info</div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="muted" for="info-method">Method</label>
            <select id="info-method" class="input" style="width:auto;min-width:120px"></select>
            <button class="close-btn" id="info-close">Tutup</button>
          </div>
        </div>
        <div class="modal-body">
          <div class="muted" id="info-meta"></div>
          <!-- Query Params UI -->
          <div id="info-query-section" style="margin-top:8px">
            <div class="muted">Query Params</div>
            <div id="info-qparams" class="row" style="gap:6px"></div>
            <button class="btn" id="info-add-param" style="margin-top:6px">Tambah Param</button>
          </div>
          <!-- Request body UI -->
          <div id="info-req-section" style="margin-top:8px">
            <div class="muted">Content-Type</div>
            <select id="info-ctype" class="input" style="width:auto;min-width:180px">
              <option value="application/json">application/json</option>
              <option value="application/x-www-form-urlencoded">application/x-www-form-urlencoded</option>
              <option value="text/plain">text/plain</option>
            </select>
            <div style="margin-top:8px">
              <div class="muted">Request Body</div>
              <textarea id="info-body-input" class="input" rows="6" placeholder="Isi body sesuai content-type"></textarea>
            </div>
          </div>
          <!-- Response -->
          <div style="margin-top:8px"><div class="muted">Status</div><div id="info-status" class="badge">-</div></div>
          <div style="margin-top:8px"><div class="muted">Headers</div><pre id="info-headers" class="code">{}</pre></div>
          <div style="margin-top:8px"><div class="muted">Body</div><pre id="info-body" class="code">(tidak ada)</pre></div>
        </div>
      </div>
      <div class="topbar">
        <div style="display:flex;align-items:center;gap:10px">
          <img src="/images/logo-kkp-pipp.png" alt="KKP" style="height:40px" />
          <div>
            <div class="brand-title">SSO PIPP</div>
            <div class="muted">Settings • Microservices + API Gateway + ETL</div>
          </div>
        </div>
        <div class="stat">
          <span class="badge" id="stat-endpoints">0 API</span>
          <span class="badge" id="stat-roles">0 Role</span>
          <canvas id="uptime-ring" width="40" height="40" class="uptime-ring"></canvas>
          <span class="badge" id="stat-uptime">Uptime: —</span>
        </div>
      </div>

      <section class="header">
        <h1>⚙️ Control Center — Microservices Management</h1>
        <p class="muted">Kelola konfigurasi API, akses, keamanan, monitoring, sinkronisasi, dan environment secara terpadu.</p>
        <div class="tabs" id="tabs">
          <button class="tab active" data-tab="api">API Config</button>
          <button class="tab" data-tab="rbac">RBAC</button>
          <button class="tab" data-tab="routing">Integration & Routing</button>
          <button class="tab" data-tab="security">Security</button>
          <button class="tab" data-tab="monitor">Monitoring</button>
          <button class="tab" data-tab="sync">Data Sync</button>
          <button class="tab" data-tab="env">Environment</button>
          <button class="tab" data-tab="advanced">Advanced</button>
        </div>
      </section>

      <!-- API CONFIG -->
      <section class="panel active" id="panel-api">
        <div class="grid">
          <div class="card">
            <h3 class="card-title">API Overview</h3>
            <div class="kpi">
              <div class="item"><div class="num" id="api-count">0</div><div class="label">Total API</div></div>
              <div class="item"><div class="num" id="api-active-ratio"><span class="num-ok">0</span>/<span class="num-bad">0</span></div><div class="label">Aktif/Tidak Aktif</div></div>
            </div>
            <div class="overview-grid">
              <div class="mini" id="mini-methods">
          <div class="mini-title">Methods Mix</div>
          <div class="glow-line"></div>
          <canvas id="overview-methods" width="200" height="200"></canvas>
          <div class="mini-legend" id="legend-methods"></div>
        </div>
              <div class="mini" id="mini-access">
                 <div class="mini-title">Access Ratio</div>
                  <div class="glow-line"></div>
                  <canvas id="overview-access" width="84" height="84"></canvas>
                  <!-- Hilangkan badge persentase otomatis -->
                  <div class="badge-small" id="access-badge" style="display:none"></div>
                  <div class="mini-legend" id="legend-access"></div>
            </div>
            <div class="mini">
               <div class="mini-title">Auth per Group</div>
               <div class="glow-line"></div>
               <canvas id="overview-auth-group" width="280" height="140"></canvas>
               <div class="mini-legend" id="legend-auth-group"></div>
            </div>
            <div class="mini">
               <div class="mini-title">API per Group</div>
               <div class="glow-line"></div>
               <canvas id="overview-group" width="280" height="140"></canvas>
               <div class="badge-small" id="group-badge">0 group</div>
               <div class="mini-legend" id="legend-group"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Register API Endpoint</h3>
              <div class="actions">
                <button class="btn glow" id="btn-add-api">Simpan API</button>
                <button class="btn secondary glow" id="btn-backup">Backup</button>
                <label class="btn outline" for="restore-file">Restore JSON</label>
                <input type="file" id="restore-file" accept="application/json" style="display:none" />
              </div>
            </div>
            <div class="row form-pairs">
              <div class="pair">
                <div class="field">
                  <span class="label">Nama API <span class="req" aria-hidden="true">*</span></span>
                  <input class="input" id="api-name" placeholder="mis. Auth Service" aria-required="true" style="text-transform:uppercase" />
                </div>
              </div>
              <div class="pair">
                <div class="row access-method">
                  <div class="field" style="flex:0 1 240px">
                    <span class="label">Akses</span>
                    <select id="api-access" class="input">
                      <option value="public" selected>Public</option>
                      <option value="private">Private</option>
                    </select>
                  </div>
                  <div class="field method-inline">
                    <span class="label">Method <span class="info-tip" id="method-info" title="Metode dapat dipilih lebih dari satu" aria-label="Metode dapat dipilih lebih dari satu">!</span></span>
                    <div id="method-pop" class="popover" role="dialog" aria-modal="false" aria-labelledby="method-pop-title">
                      <div class="popover-title" id="method-pop-title">Informasi Method</div>
                      <p class="muted">Metode dapat dipilih lebih dari satu. Klik tombol untuk menambah atau menghapus pilihan.</p>
                    </div>
                    <div class="seg" id="method-seg">
                      <button data-method="GET" class="active">GET</button>
                      <button data-method="POST">POST</button>
                      <button data-method="PUT">PUT</button>
                      <button data-method="DELETE">DELETE</button>
                      <button data-method="PATCH">PATCH</button>
                      <button data-method="HEAD">HEAD</button>
                    </div>
                    <span class="hint" id="method-hint">Pilih satu atau lebih metode; klik untuk toggle.</span>
                    <select id="api-method" class="input" style="display:none"><option>GET</option><option>POST</option><option>PUT</option><option>DELETE</option><option>PATCH</option><option>HEAD</option></select>
                  </div>
                </div>
              </div>
            </div>
            <div class="row form-pairs">
              <div class="pair">
                <div class="field">
                  <span class="label">URL <span class="req" aria-hidden="true">*</span></span>
                  <input class="input" id="api-url" placeholder="https://domain/path" aria-required="true" />
                  <span class="hint">Gunakan endpoint publik atau internal yang dapat diakses.</span>
                </div>
              </div>
              <div class="pair">
                <div class="field">
                  <span class="label">Authentication</span>
                  <select id="api-auth" class="input">
                    <option value="none" selected>None</option>
                    <option value="api_key">API Key</option>
                    <option value="oauth2">OAuth2</option>
                    <option value="jwt">JWT</option>
                    <option value="basic">Basic</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="field" style="flex:1 1 220px">
                <span class="label">Group</span>
                <input class="input" id="api-group" placeholder="PIPP, SPB, SHTI, Logbook" />
              </div>
              <div class="field" style="flex:1 1 160px">
                <span class="label">Versi</span>
                <input class="input" id="api-version" placeholder="v1, v2" />
              </div>
            </div>
              <!-- Auth Config Sections -->
              <div class="row" id="auth-config" style="gap:12px">
                <div id="auth-none" class="field" style="flex:1 1 100%">
                  <span class="hint">Tanpa authentication.</span>
                </div>
                <div id="auth-api_key" class="field" style="flex:1 1 100%;display:none">
                  <span class="label">API Key</span>
                  <div class="row">
                    <div class="field" style="flex:1 1 160px">
                      <span class="label">Lokasi</span>
                      <select id="auth-api-key-loc" class="input">
                        <option value="header" selected>Header</option>
                        <option value="query">Query</option>
                      </select>
                    </div>
                    <div class="field" style="flex:1 1 180px">
                      <span class="label">Prefix <span class="info-tip" title="Jika Authorization dan prefix ≠ None, nilai otomatis menjadi '<prefix> <nilai>'">i</span></span>
                      <select id="auth-api-key-prefix" class="input">
                        <option value="ApiKey" selected>ApiKey</option>
                        <option value="Bearer">Bearer</option>
                        <option value="Token">Token</option>
                        <option value="None">None</option>
                      </select>
                    </div>
                  </div>
                  <div class="row">
                    <div class="field" style="flex:1 1 220px">
                      <span class="label">Nama Header/Param</span>
                      <input id="auth-api-key-name" class="input" placeholder="Authorization / X-API-Key / api_key" />
                    </div>
                    <div class="field" style="flex:1 1 220px">
                      <span class="label">Nilai <span class="info-tip" id="api-key-tip" title="Tooltip format nilai otomatis">!</span></span>
                      <div id="api-key-pop" class="popover" role="dialog" aria-modal="false" aria-labelledby="api-key-pop-title">
                        <div class="popover-title" id="api-key-pop-title">Format Nilai</div>
                        <span class="hint" id="api-key-value-format"></span>
                      </div>
                      <input id="auth-api-key-value" class="input" placeholder="ApiKey &lt;nilai&gt;" />
                    </div>
                  </div>
                  <span class="hint">Jika menggunakan Header <code>Authorization</code>, format umum: <code>ApiKey &lt;nilai&gt;</code> atau <code>Bearer &lt;token&gt;</code>.</span>
                </div>
                <div id="auth-oauth2" class="field" style="flex:1 1 100%;display:none">
                  <span class="label">OAuth2 Access Token</span>
                  <input id="auth-oauth2-token" class="input" placeholder="akses token (Bearer)" />
                  <span class="hint">Masukkan access token yang sudah didapat. Pengambilan token tidak diotomasi di halaman ini.</span>
                </div>
                <div id="auth-jwt" class="field" style="flex:1 1 100%;display:none">
                  <span class="label">JWT Token</span>
                  <input id="auth-jwt-token" class="input" placeholder="eyJ..." />
                </div>
                <div id="auth-basic" class="field" style="flex:1 1 100%;display:none">
                  <div class="row">
                    <div class="field" style="flex:1 1 220px">
                      <span class="label">Username</span>
                      <input id="auth-basic-user" class="input" />
                    </div>
                    <div class="field" style="flex:1 1 220px">
                      <span class="label">Password</span>
                      <input id="auth-basic-pass" class="input" type="password" />
                    </div>
                  </div>
                </div>
              </div>
              <div class="field" style="flex:1 1 320px">
                <span class="label">Parameter (JSON) opsional</span>
                <textarea class="input" id="api-params" placeholder='{"limit":10}' rows="2"></textarea>
              </div>
            </div>
            <!-- Actions moved to header card-head -->
          </div>
          <div class="card">
            <h3>Daftar API</h3>
            <div class="toolbar">
              <input class="input" id="api-search" placeholder="Cari nama/group/method..." />
              <div class="row">
                <button class="btn" id="btn-test-all">Test Semua</button>
                <button class="btn secondary" id="btn-enable-all">Enable Semua</button>
                <button class="btn danger" id="btn-disable-all">Disable Semua</button>
              </div>
            </div>
            <table>
              <thead><tr><th>Nama</th><th>Group</th><th>Method</th><th>Access</th><th>Auth</th><th>Auth Detail</th><th>Versi</th><th>Status</th><th>Aksi</th></tr></thead>
               <tbody id="api-table"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RBAC -->
      <section class="panel" id="panel-rbac">
        <div class="grid">
          <div class="card">
            <h3>Role Definition</h3>
            <div class="row">
              <input class="input" id="role-name" placeholder="Role (Admin, Developer, Viewer, Operator)" />
              <button class="btn" id="btn-add-role">Tambah Role</button>
            </div>
            <ul id="role-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card">
            <h3>Access Matrix</h3>
            <div class="row">
              <select id="matrix-role" class="input"></select>
              <button class="btn" id="btn-save-matrix">Simpan Hak Akses</button>
            </div>
            <table>
              <thead><tr><th>API</th><th>R</th><th>W</th><th>U</th><th>D</th></tr></thead>
              <tbody id="matrix-table"></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Token Management</h3>
            <div class="row">
              <button class="btn" id="btn-gen-token">Generate Token</button>
              <input class="input" id="token-label" placeholder="Label token (opsional)" />
            </div>
            <table>
              <thead><tr><th>Token</th><th>Label</th><th>Aksi</th></tr></thead>
              <tbody id="token-table"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- INTEGRATION & ROUTING -->
      <section class="panel" id="panel-routing">
        <div class="grid">
          <div class="card"><h3>Service Registry</h3><ul id="service-list" class="muted" style="list-style:none;padding-left:0"></ul></div>
          <div class="card"><h3>Routing Rules</h3>
            <div class="row"><input class="input" id="route-from" placeholder="Dari Service" /><input class="input" id="route-to" placeholder="Ke Service" /><button class="btn" id="btn-add-route">Tambah Rule</button></div>
            <ul id="route-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Load Balancing & Fallback</h3>
            <div class="row"><input class="input" id="lb-service" placeholder="Service" /><input class="input" id="lb-weight" placeholder="Bobot (1-100)" /><button class="btn" id="btn-set-lb">Set</button></div>
            <p class="muted">Retry Policy: <span id="retry-policy">3x / 500ms</span></p>
          </div>
        </div>
      </section>

      <!-- SECURITY -->
      <section class="panel" id="panel-security">
        <div class="grid">
          <div class="card"><h3>OIDC/OAuth Client Setup</h3>
            <div class="row"><input class="input" id="oauth-client" placeholder="Client ID" /><input class="input" id="oauth-secret" placeholder="Client Secret" /><button class="btn" id="btn-save-oauth">Simpan</button></div>
          </div>
          <div class="card"><h3>API Key Management</h3>
            <div class="row"><button class="btn" id="btn-gen-key">Buat API Key</button></div>
            <ul id="key-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>IP Whitelisting</h3>
            <div class="row"><input class="input" id="ip-input" placeholder="IP (x.x.x.x)" /><button class="btn" id="btn-add-ip">Tambah IP</button></div>
            <ul id="ip-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Audit Trail Logging</h3>
            <div class="row"><button class="btn" id="btn-clear-logs">Clear Logs</button></div>
            <ul id="log-list" class="muted" style="list-style:none;padding-left:0;max-height:180px;overflow:auto"></ul>
          </div>
        </div>
      </section>

      <!-- MONITORING -->
      <section class="panel" id="panel-monitor">
        <div class="grid">
          <div class="card"><h3>API Usage Dashboard</h3>
            <canvas id="chart-usage" width="600" height="180" style="width:100%"></canvas>
          </div>
          <div class="card"><h3>Service Health Check</h3>
            <div class="row"><button class="btn" id="btn-health">Check Health</button></div>
            <ul id="health-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Error Tracking & Alerts</h3>
            <p class="muted">Threshold lambat: <input class="input" id="alert-th" placeholder="ms" style="max-width:120px;display:inline-block" /> • Notifikasi: on</p>
          </div>
        </div>
      </section>

      <!-- SYNC -->
      <section class="panel" id="panel-sync">
        <div class="grid">
          <div class="card"><h3>Manual Sync Trigger</h3>
            <div class="row"><input class="input" id="sync-target" placeholder="Sistem (SPB, SHTI, PIPP)" /><button class="btn" id="btn-sync">Trigger</button></div>
            <ul id="sync-log" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Sync Schedule Setup</h3>
            <div class="row"><input class="input" id="sync-cron" placeholder="Jadwal (contoh: harian 02:00)" /><button class="btn" id="btn-set-cron">Simpan Jadwal</button></div>
            <ul id="cron-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Data Status Report</h3>
            <ul id="status-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
        </div>
      </section>

      <!-- ENV -->
      <section class="panel" id="panel-env">
        <div class="grid">
          <div class="card"><h3>Environment Variables</h3>
            <div class="row"><input class="input" id="env-key" placeholder="KEY" /><input class="input" id="env-val" placeholder="VALUE" /><button class="btn" id="btn-add-env">Tambah</button></div>
            <ul id="env-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Server Connection Settings</h3>
            <div class="row"><input class="input" id="srv-name" placeholder="Nama Server" /><input class="input" id="srv-host" placeholder="Host/IP" /><button class="btn" id="btn-add-srv">Simpan</button></div>
            <ul id="srv-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Version Deployment Control</h3>
            <p class="muted">Lacak versi konfigurasi & deployment service</p>
            <ul id="ver-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
        </div>
      </section>

      <!-- ADVANCED -->
      <section class="panel" id="panel-advanced">
        <div class="grid">
          <div class="card"><h3>Webhook Management</h3>
            <div class="row"><input class="input" id="wh-url" placeholder="Webhook URL" /><button class="btn" id="btn-add-wh">Tambah</button></div>
            <ul id="wh-list" class="muted" style="list-style:none;padding-left:0"></ul>
          </div>
          <div class="card"><h3>Service Dependency Map</h3>
            <p class="muted">Visual sederhana dependensi antar service</p>
            <canvas id="dep-map" width="600" height="200" style="width:100%"></canvas>
          </div>
          <div class="card"><h3>Integration Sandbox</h3>
            <div class="row"><input class="input" id="sb-url" placeholder="URL" /><select id="sb-method" class="input"><option>GET</option><option>POST</option><option>PUT</option><option>DELETE</option></select><button class="btn" id="btn-run-sb">Run</button></div>
            <pre id="sb-out" class="muted" style="max-height:180px;overflow:auto"></pre>
          </div>
        </div>
      </section>
    </main>
  </div>
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>
  <script>
    (function(){
      const sidebar = document.querySelector('.sidebar');
      const btn = document.getElementById('toggleSidebar');
      const collapsed = localStorage.getItem('sidebarCollapsed') === '1';
      if (collapsed) sidebar.classList.add('collapsed');
      if (btn) {
        btn.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
          const isCollapsed = sidebar.classList.contains('collapsed');
          localStorage.setItem('sidebarCollapsed', isCollapsed ? '1' : '0');
          btn.textContent = isCollapsed ? '☰' : '◀';
        });
        btn.textContent = collapsed ? '☰' : '◀';
      }
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/settings.js"></script>
</body>
</html>